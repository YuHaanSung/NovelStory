<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>NovelHub - ì›¹ì†Œì„¤ í”Œë«í¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; }

        /* ë­í‚¹ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .rank-card { transition: all 0.2s; }
        .rank-card:hover { transform: translateY(-2px); background-color: #f1f5f9; }
    </style>
</head>
<body>

<div id="header-placeholder"></div>
<script src="/js/header.js"></script>

<div class="max-w-6xl mx-auto my-8 px-4">

    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-3xl p-12 text-white shadow-2xl mb-12 text-center relative overflow-hidden">
        <div class="relative z-10">
            <h1 class="text-5xl font-extrabold mb-6 leading-tight tracking-tight">
                ë‹¹ì‹ ì˜ ìƒìƒì„ <br class="md:hidden">í¼ì¹˜ëŠ” ê³³, NovelHub
            </h1>
            <p class="text-indigo-100 text-lg md:text-xl max-w-2xl mx-auto font-medium">
                ìˆ˜ë§ì€ ë…ìë“¤ì´ ì‘ê°€ë‹˜ì˜ ë†€ë¼ìš´ ì´ì•¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.<br>
                ì§€ê¸ˆ ë°”ë¡œ ì—°ì¬ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.
            </p>
        </div>

        <div class="absolute top-0 left-0 w-72 h-72 bg-white/10 rounded-full -translate-x-1/2 -translate-y-1/2 blur-3xl opacity-70"></div>
        <div class="absolute bottom-0 right-0 w-[500px] h-[500px] bg-purple-500/30 rounded-full translate-x-1/3 translate-y-1/3 blur-3xl opacity-70"></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2 border-b pb-3">
                <i class="fas fa-fire text-orange-500"></i> ì¡°íšŒìˆ˜ ê¸‰ìƒìŠ¹ TOP 5
            </h2>
            <div id="view-ranking" class="space-y-2">
                <p class="text-gray-400 text-center py-4">ë°ì´í„° ë¶„ì„ ì¤‘...</p>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2 border-b pb-3">
                <i class="fas fa-heart text-pink-500"></i> ë…ì ê°•ë ¥ ì¶”ì²œ TOP 5
            </h2>
            <div id="like-ranking" class="space-y-2">
                <p class="text-gray-400 text-center py-4">ë°ì´í„° ë¶„ì„ ì¤‘...</p>
            </div>
        </div>
    </div>

    <div class="mb-4 flex items-center justify-between">
        <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-book-open text-indigo-600"></i> ìµœì‹  ì—°ì¬ ì‘í’ˆ</h2>
    </div>

    <div id="novel-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="col-span-full text-center py-20 text-gray-400">
            <i class="fas fa-circle-notch fa-spin text-3xl mb-3"></i><br>ì‘í’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        loadViewRanking();      // ì¡°íšŒìˆ˜ ë­í‚¹
        loadRecommendRanking(); // ì¶”ì²œìˆ˜ ë­í‚¹
        loadAllNovels();        // ì „ì²´ ëª©ë¡
    });

    // 1. ì¡°íšŒìˆ˜ ë­í‚¹ ë¡œë“œ
    function loadViewRanking() {
        fetch('/api/novels/topViewed')
            .then(res => res.json())
            .then(novels => renderRanking(novels, 'view-ranking', 'views'));
    }

    // 2. ì¶”ì²œìˆ˜ ë­í‚¹ ë¡œë“œ
    function loadRecommendRanking() {
        fetch('/api/novels/topRecommended')
            .then(res => res.json())
            .then(novels => renderRanking(novels, 'like-ranking', 'likes'));
    }

    // ë­í‚¹ ê·¸ë¦¬ê¸° (ê³µí†µ í•¨ìˆ˜)
    function renderRanking(novels, elementId, type) {
        const container = document.getElementById(elementId);
        container.innerHTML = '';

        if (!novels || novels.length === 0) {
            container.innerHTML = `<div class="text-center text-gray-400 py-4 text-sm">ì§‘ê³„ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
        }

        novels.forEach((novel, index) => {
            let rankBadge = `<span class="w-6 h-6 bg-gray-100 text-gray-500 rounded-full flex items-center justify-center text-xs font-bold">${index + 1}</span>`;
            if (index === 0) rankBadge = `ğŸ¥‡`;
            if (index === 1) rankBadge = `ğŸ¥ˆ`;
            if (index === 2) rankBadge = `ğŸ¥‰`;

            let countHtml = '';
            if (type === 'views') {
                countHtml = `<span class="text-xs text-gray-500 flex items-center gap-1"><i class="far fa-eye"></i> ${(novel.totalCounts || 0).toLocaleString()}</span>`;
            } else {
                countHtml = `<span class="text-xs text-pink-500 flex items-center gap-1"><i class="fas fa-heart"></i> ${(novel.totalLikes || 0).toLocaleString()}</span>`;
            }

            const html = `
                <div class="rank-card flex items-center gap-3 p-3 rounded-xl cursor-pointer"
                     onclick="location.href='novel_home.html?title=${encodeURIComponent(novel.title)}'">
                    <div class="text-lg w-8 text-center shrink-0">${rankBadge}</div>
                    <div class="flex-1 min-w-0">
                        <div class="font-bold text-gray-800 text-sm truncate">${novel.title}</div>
                        <div class="text-xs text-gray-400 truncate">${novel.author}</div>
                    </div>
                    <div class="shrink-0">${countHtml}</div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    // ì „ì²´ ì†Œì„¤ ëª©ë¡ ë¡œë“œ (URL ê²€ìƒ‰ì–´ ì²˜ë¦¬ í¬í•¨)
    function loadAllNovels() {
        const urlParams = new URLSearchParams(window.location.search);
        const keyword = urlParams.get('keyword');
        const api = keyword ? `/api/novels/search?keyword=${encodeURIComponent(keyword)}` : '/api/novels';

        fetch(api)
            .then(res => res.json())
            .then(novels => {
                const list = document.getElementById('novel-list');
                list.innerHTML = '';

                if (!novels || novels.length === 0) {
                    list.innerHTML = `<div class="col-span-full text-center py-20 text-gray-400">ë“±ë¡ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    return;
                }

                novels.forEach(novel => {
                    list.innerHTML += `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition cursor-pointer"
                             onclick="location.href='novel_home.html?title=${encodeURIComponent(novel.title)}'">
                            <div class="h-32 bg-gray-100 flex items-center justify-center text-gray-300">
                                <i class="fas fa-book-open text-3xl"></i>
                            </div>
                            <div class="p-4">
                                <h3 class="font-bold text-gray-800 truncate mb-1">${novel.title}</h3>
                                <p class="text-sm text-gray-500 mb-3">${novel.author}</p>
                                <div class="flex gap-3 text-xs text-gray-400 border-t pt-2">
                                    <span><i class="far fa-eye"></i> ${(novel.totalCounts || 0)}</span>
                                    <span><i class="fas fa-heart"></i> ${(novel.totalLikes || 0)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
    }
</script>
</body>
</html>