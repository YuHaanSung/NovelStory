<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì†Œì„¤ ìƒì„¸ì •ë³´</title>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f2f4f7; display: flex; justify-content: center; margin: 0; padding: 20px; }
        .container { max-width: 800px; width: 100%; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; }

        /* ìƒë‹¨ ì†Œì„¤ ì •ë³´ */
        .novel-header { padding: 40px; background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; }
        .novel-title { font-size: 32px; font-weight: bold; margin: 0 0 10px 0; }
        .novel-meta { font-size: 14px; opacity: 0.9; margin-bottom: 20px; }
        .novel-tag { display: inline-block; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px; margin-right: 5px; }
        .novel-summary { font-size: 16px; line-height: 1.6; opacity: 0.95; white-space: pre-line; }

        /* í•˜ë‹¨ íšŒì°¨ ëª©ë¡ */
        .part-list-container { padding: 30px; }
        .section-title { font-size: 20px; font-weight: bold; color: #333; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }

        .part-item { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: 0.2s; }
        .part-item:hover { background-color: #f8f9fa; transform: translateX(5px); }
        .part-title { font-weight: bold; color: #333; }
        .part-num { color: #888; font-size: 14px; margin-right: 15px; }

        .btn-read { background: #6c5ce7; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="novel-header">
        <div id="tags"></div>
        <h1 class="novel-title" id="title">ë¡œë”© ì¤‘...</h1>
        <div class="novel-meta">
            <span id="author">ì‘ê°€ëª…</span> |
            <span id="uploadDate">ì—°ì¬ì¤‘</span>
        </div>
        <div class="novel-summary" id="summary"></div>
    </div>

    <div class="part-list-container">
        <div class="section-title">ğŸ“– íšŒì°¨ ëª©ë¡</div>
        <div id="part-list">
        </div>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const novelTitle = urlParams.get('title');

    window.onload = function() {
        if (!novelTitle) { alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤."); location.href = 'index.html'; return; }

        // 1. ì†Œì„¤ ê¸°ë³¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë°©ê¸ˆ ë§Œë“  API)
        fetch('/api/novels/' + encodeURIComponent(novelTitle))
            .then(res => res.json())
            .then(data => {
                document.getElementById('title').innerText = data.title;
                document.getElementById('author').innerText = data.author;
                document.getElementById('summary').innerText = data.summary;

                // íƒœê·¸ ì²˜ë¦¬
                const tagContainer = document.getElementById('tags');
                const tags = Array.isArray(data.tag) ? data.tag : [data.tag];
                tags.forEach(tag => {
                    tagContainer.innerHTML += `<span class="novel-tag">#${tag}</span>`;
                });
            });

        // 2. íšŒì°¨ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ê¸°ì¡´ API í™œìš©)
        fetch(`/api/novels/${encodeURIComponent(novelTitle)}/parts`)
            .then(res => res.json())
            .then(parts => {
                const list = document.getElementById('part-list');

                // íšŒì°¨ ë²ˆí˜¸ ìˆœì„œëŒ€ë¡œ ì •ë ¬ (1í™”, 2í™”...)
                parts.sort((a, b) => a.partNumber - b.partNumber);

                if(parts.length === 0) {
                    list.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">ë“±ë¡ëœ íšŒì°¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                parts.forEach(part => {
                    const html = `
                        <div class="part-item" onclick="readEpisode(${part.partNumber})">
                            <div>
                                <span class="part-num">${part.partNumber}í™”</span>
                                <span class="part-title">${part.partTitle}</span>
                            </div>
                            <button class="btn-read">ì½ê¸°</button>
                        </div>
                    `;
                    list.innerHTML += html;
                });
            });
    };

    function readEpisode(partNumber) {
        // ë·°ì–´ í˜ì´ì§€ë¡œ ì´ë™!
        location.href = `novel_viewer.html?title=${encodeURIComponent(novelTitle)}&part=${partNumber}`;
    }
</script>

</body>
</html>